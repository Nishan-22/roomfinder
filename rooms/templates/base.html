<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}RoomFinder | Premium Living{% endblock %}</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;900&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { 
                extend: { 
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                        display: ['"Outfit"', 'sans-serif'],
                    },
                    colors: { 
                        // Switching to a premium Indigo/Violet theme
                        primary: { 
                            50: '#eef2ff', 
                            100: '#e0e7ff', 
                            500: '#6366f1', 
                            600: '#4f46e5', 
                            700: '#4338ca', 
                            900: '#312e81' 
                        }
                    }
                }
            }
        }
    </script>

    <style>
        @keyframes slideDown { from { opacity:0; transform:translateY(-20px);} to {opacity:1; transform:translateY(0);} }
        @keyframes fadeInScale { from { opacity:0; transform:scale(0.95);} to {opacity:1; transform:scale(1);} }
        
        .animate-slide-down { animation: slideDown .5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-pop { animation: fadeInScale .3s ease-out forwards; }
        
        /* Modern Glass Effect */
        .glass-panel { 
            background: rgba(255, 255, 255, 0.85); 
            backdrop-filter: blur(16px); 
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255,255,255, 0.5);
        }
        .dark .glass-panel { 
            background: rgba(15, 23, 42, 0.8); 
            border: 1px solid rgba(255,255,255, 0.1);
        }
    </style>
</head>

<body class="bg-slate-50 dark:bg-slate-950 text-slate-800 dark:text-slate-200 min-h-screen flex flex-col font-sans transition-colors duration-300 relative overflow-x-hidden">

<div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
    <div class="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-primary-500/10 rounded-full blur-[100px]"></div>
    <div class="absolute bottom-[-10%] right-[-10%] w-[600px] h-[600px] bg-purple-500/10 rounded-full blur-[120px]"></div>
</div>

<header id="navbar" class="fixed top-0 w-full z-50 px-4 py-4">
    <nav class="max-w-6xl mx-auto glass-panel rounded-2xl shadow-lg shadow-gray-200/50 dark:shadow-black/20 px-6 py-3 flex justify-between items-center animate-slide-down">

        <a href="{% url 'room_list' %}" class="flex items-center gap-2 group">
            <div class="w-8 h-8 bg-primary-600 rounded-lg flex items-center justify-center text-white font-display font-bold text-xl group-hover:rotate-12 transition-transform">R</div>
            <span class="text-xl font-display font-black tracking-tight text-slate-900 dark:text-white">Room<span class="text-primary-600">Finder</span></span>
        </a>

        <div class="hidden md:flex items-center space-x-1 bg-gray-100/50 dark:bg-gray-800/50 p-1 rounded-full border border-gray-200/50 dark:border-gray-700">
            <a href="{% url 'room_list' %}" class="px-5 py-2 rounded-full text-sm font-semibold transition-all hover:bg-white dark:hover:bg-gray-700 hover:shadow-sm {% if request.resolver_match.url_name == 'room_list' %}bg-white dark:bg-gray-700 text-primary-600 shadow-sm{% else %}text-gray-600 dark:text-gray-400{% endif %}">
                Explore
            </a>
            {% if user.is_authenticated %}
                <a href="{% url 'dashboard' %}" class="px-5 py-2 rounded-full text-sm font-semibold transition-all hover:bg-white dark:hover:bg-gray-700 hover:shadow-sm text-gray-600 dark:text-gray-400">
                    Dashboard
                </a>
            {% endif %}
        </div>

        <div class="flex items-center gap-3">

            <button id="theme-toggle" class="w-10 h-10 rounded-full flex items-center justify-center bg-transparent hover:bg-gray-100 dark:hover:bg-gray-800 transition text-gray-500">
                <span id="theme-toggle-dark-icon" class="hidden text-lg">üåô</span>
                <span id="theme-toggle-light-icon" class="hidden text-lg">‚òÄÔ∏è</span>
            </button>

            {% if user.is_authenticated %}
                <div class="hidden sm:flex flex-col text-right mr-2 leading-tight">
                    <span class="text-xs text-gray-500 font-semibold uppercase tracking-wider">Hello</span>
                    <span class="text-sm font-bold text-slate-900 dark:text-white">{{ user.username }}</span>
                </div>

                <button id="logoutBtn" class="bg-slate-900 dark:bg-white text-white dark:text-slate-900 px-5 py-2.5 rounded-xl text-xs font-bold uppercase tracking-wider hover:bg-primary-600 dark:hover:bg-primary-100 hover:shadow-lg dark:hover:text-primary-700 transition-all transform hover:-translate-y-0.5">
                    Logout
                </button>
            {% else %}
                <a href="{% url 'login' %}" class="bg-primary-600 text-white px-6 py-2.5 rounded-xl text-sm font-bold shadow-lg shadow-primary-600/30 hover:bg-primary-700 hover:shadow-primary-600/50 transition-all transform hover:-translate-y-0.5">
                    Login
                </a>
            {% endif %}
        </div>
    </nav>

    <form id="logoutForm" action="{% url 'logout' %}" method="POST" class="hidden">
        {% csrf_token %}
    </form>
</header>

<main class="flex-grow pt-28 pb-12">
    {% if messages %}
    <div class="max-w-4xl mx-auto px-6 mb-8">
        {% for message in messages %}
        <div class="flex items-center p-4 rounded-2xl shadow-sm border-l-4 mb-3 animate-pop {% if message.tags == 'error' %}bg-red-50 dark:bg-red-900/10 border-red-500 text-red-700 dark:text-red-200{% else %}bg-emerald-50 dark:bg-emerald-900/10 border-emerald-500 text-emerald-700 dark:text-emerald-200{% endif %}">
            <span class="font-medium">{{ message }}</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <div class="w-full">
        {% block content %}{% endblock %}
    </div>
</main>

<footer class="border-t border-gray-200 dark:border-gray-800 bg-white/50 dark:bg-slate-900/50 backdrop-blur-sm mt-auto">
    <div class="max-w-7xl mx-auto px-6 py-8 text-center">
        <p class="text-sm text-gray-500">¬© 2024 RoomFinder Inc. Premium Living.</p>
    </div>
</footer>

<div id="logoutModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm hidden items-center justify-center z-[100] transition-opacity">
    <div class="bg-white dark:bg-slate-900 w-[90%] max-w-sm p-8 rounded-3xl shadow-2xl border border-gray-100 dark:border-gray-800 text-center animate-pop relative overflow-hidden">
        
        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-primary-500 to-purple-600"></div>

        <div class="mb-6">
            <div class="w-16 h-16 bg-red-50 dark:bg-red-900/20 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">
                üëã
            </div>
            <h2 class="text-2xl font-display font-bold text-slate-900 dark:text-white mb-2">Leaving so soon?</h2>
            <p class="text-slate-500 text-sm leading-relaxed">Are you sure you want to log out? You will need your credentials to access your dashboard again.</p>
        </div>

        <div class="flex flex-col sm:flex-row gap-3">
            <button id="cancelLogout" class="flex-1 py-3 px-4 rounded-xl font-bold text-sm bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition">
                Cancel
            </button>
            <button id="confirmLogout" class="flex-1 py-3 px-4 rounded-xl font-bold text-sm bg-red-600 text-white shadow-lg shadow-red-600/30 hover:bg-red-700 hover:shadow-red-600/40 transition">
                Yes, Logout
            </button>
        </div>
    </div>
</div>

<script>
    // üåô THEME SYSTEM
    const themeToggleBtn = document.getElementById('theme-toggle');
    const darkIcon = document.getElementById('theme-toggle-dark-icon');
    const lightIcon = document.getElementById('theme-toggle-light-icon');

    function syncIcons() {
        if (document.documentElement.classList.contains('dark')) {
            lightIcon.classList.remove('hidden');
            darkIcon.classList.add('hidden');
        } else {
            darkIcon.classList.remove('hidden');
            lightIcon.classList.add('hidden');
        }
    }

    if (localStorage.getItem('color-theme') === 'dark' ||
        (!localStorage.getItem('color-theme') &&
         window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark');
    }
    syncIcons();

    themeToggleBtn?.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
        localStorage.setItem('color-theme',
            document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        syncIcons();
    });

    // üö™ LOGOUT MODAL
    const logoutBtn = document.getElementById("logoutBtn");
    const logoutModal = document.getElementById("logoutModal");
    const cancelLogout = document.getElementById("cancelLogout");
    const confirmLogout = document.getElementById("confirmLogout");
    const logoutForm = document.getElementById("logoutForm");

    logoutBtn?.addEventListener("click", () => {
        logoutModal.classList.remove("hidden");
        logoutModal.classList.add("flex");
    });

    cancelLogout?.addEventListener("click", () => {
        logoutModal.classList.add("hidden");
        logoutModal.classList.remove("flex"); // Ensure flex is removed to hide correctly
    });

    confirmLogout?.addEventListener("click", () => {
        logoutForm.submit();
    });
</script>

</body>
</html>